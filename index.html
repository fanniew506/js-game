<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
    <script src="https://code.createjs.com/tweenjs-0.6.2.min.js"></script>
    <script src="https://code.createjs.com/preloadjs-0.6.2.min.js"></script>
    <script>
      let stage;
      let a;
      let b;
      let container;
      let animation;
      let data = {
        images: ["./images/char.png"],
        frames: {width: 64, height:64},
        animations: {
          run:[0, 2, 'run']
        }
      }

      let position = {
        center: 320,
        right: 430,
        left: 230
      }

      let i = 0;

      let bitmap;
      let coinArr = [];
      let coinCount = 0;
      let randomPos = [[320, 160], [340, 310], [360, 480]]
      let Key = {
        _pressed: {
          LEFT: 37,
          UP: 38,
          RIGHT: 39,
          DOWN: 40 },

        onKeydown: function(event) {
          if (event.keyCode === this._pressed.RIGHT) {
            if (animation.x === position.left) {
              createjs.Tween.get(animation).to({x: position.center}, 400,createjs.Ease.quadInOut)
            } else if (animation.x === position.center) {
              createjs.Tween.get(animation).to({x: position.right}, 400,createjs.Ease.quadInOut)
            }
          } else if (event.keyCode === this._pressed.LEFT) {
            if (animation.x === position.right) {
              createjs.Tween.get(animation).to({x: position.center}, 400,createjs.Ease.quadInOut)
            } else if (animation.x === position.center) {
              createjs.Tween.get(animation).to({x: position.left}, 400,createjs.Ease.quadInOut)
            }
          }
        }
      };

      window.addEventListener('keydown',  function(event) { Key.onKeydown(event); })

      function init() {
        stage = new createjs.Stage("gamecanvas");
        stage.addChild(container);

        let spriteSheet = new createjs.SpriteSheet(data);
        animation = new createjs.Sprite(spriteSheet,"run");
        animation.y = 450;
        animation.x = position.center;
        stage.addChild(animation)
        createjs.Ticker.setFPS(40);
        createjs.Ticker.addEventListener("tick", stage);
        createjs.Ticker.on("tick", tick);

        let road = new createjs.Bitmap("./images/road.png");
        road.x = 100;
        road.y = 103;
        stage.addChild(road);
        play()
      }

      function play() {
        bitmap = new createjs.Bitmap("./images/coin.png");
        bitmap.height = 40;
        bitmap.width = 40;
        let randomIdx = Math.floor(Math.random() * 3)
        bitmap.x = randomPos[randomIdx][0];
        bitmap.y = 110;
        coinArr.push(bitmap);
        createjs.Ticker.setFPS(40);
        createjs.Ticker.addEventListener("tick", stage);
        stage.addChild(bitmap)
        createjs.Tween.get(coinArr[i]).to({x:randomPos[randomIdx][1], y:700, scaleX:5, scaleY:5}, 3000, createjs.Ease.quadIn);

        let randomTime = Math.floor(Math.random()* 1500 + 200)
        i+=1;
        setTimeout(play, randomTime);
      }

      function getRandom() {
        return Math.random() * 600 - 300;
      }


      function tick() {

        let coinDup = coinArr;

        for (let j = 0; j < coinDup.length; j++) {
          if (coinDup[j].y === 700){
            stage.removeChild(coinArr[j])
            coinArr.splice(j, 1)
            i -= 1;
          } else if ( coinDup[j].y > 400 && coinDup[j].y < 490) {
              if ( coinDup[j].x > 200 && coinDup[j].x < 250 && animation.x === position.left) {
                stage.removeChild(coinArr[j])
                coinArr.splice(j, 1)
                i -= 1;
                coinCount += 1;
                console.log("Hit")
              }
          }

        }

      }
      // animation.addEventListener()

    </script>
  </head>
  <body onload="init();">
    <canvas id="gamecanvas" width="700" height="600"></canvas>
  </body>
</html>
