<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
    <script src="https://code.createjs.com/tweenjs-0.6.2.min.js"></script>
    <script src="https://code.createjs.com/preloadjs-0.6.2.min.js"></script>
    <script>
      let stage;
      let a;
      let b;
      let container;
      let animation;
      let data = {
        images: ["./images/char.png"],
        frames: {width: 64, height:64},
        animations: {
          run:[0, 2, 'run']
        }
      }
      let position = {
        "posCenter": 320,
        "posRight": 430,
        "posLeft": 230
      }

      let bitmap;
      let coinArr = [];
      let coinIdx = 0;
      let randomPos = [[320, 180], [340, 310], [360, 480]]

      function init() {
        stage = new createjs.Stage("gamecanvas");
        stage.addChild(container);

        let spriteSheet = new createjs.SpriteSheet(data);
        animation = new createjs.Sprite(spriteSheet,"run");
        animation.y = 450;
        animation.x = position["posCenter"];
        stage.addChild(animation)
        createjs.Ticker.setFPS(10);
        createjs.Ticker.addEventListener("tick", stage);
        createjs.Ticker.on("tick", tick);

        let road = new createjs.Bitmap("./images/road.png");
        road.x = 100;
        road.y = 103;
        stage.addChild(road);
        play()
      }

      function play() {
        bitmap = new createjs.Bitmap("./images/cloud.png");
        let randomIdx = Math.floor(Math.random() * 3)
        bitmap.x = randomPos[randomIdx][0];
        bitmap.y = 110;
        coinArr.push(bitmap);
        createjs.Ticker.setFPS(10);
        createjs.Ticker.addEventListener("tick", stage);
        stage.addChild(bitmap)
        createjs.Tween.get(coinArr[coinIdx]).to({x:180, y:700, scaleX:5, scaleY:5}, 4000, createjs.Ease.quadInOut);
        let local = coinIdx;
        setTimeout((local) => {
          if ( animation.x === 220){
            debugger;
            console.log("YAY") }}, 2800)

        let randomTime = Math.floor(Math.random()*1500)
        coinIdx+=1;
        // setTimeout(play, randomTime);
      }

      function getRandom() {
        return Math.random() * 600 - 300;
      }

      let Key = {
        _pressed: {},

        LEFT: 37,
        UP: 38,
        RIGHT: 39,
        DOWN: 40,

        isDown: function(keyCode) {
          return this._pressed[keyCode];
        },

        onKeydown: function(event) {
          if (event.keyCode === 39) {
            createjs.Tween.get(animation).to({x: animation.x + 100}, 600,createjs.Ease.quadInOut)
          } else if (event.keyCode === 37) {
            createjs.Tween.get(animation).to({x: animation.x - 100}, 600,createjs.Ease.quadInOut)
          }
        }
      };

      window.addEventListener('keydown',  function(event) { Key.onKeydown(event); })

      function tick() {
        // debugger
        let coinDup = coinArr;
        let coin = coinArr.length
        for (var i = 0; i < coin; i++) {
          if (coinDup[i].y === 700){
            stage.removeChild(coinDup[i])
            // coinArr.delete(i)
          }
          // debugger
        }
          // debugger

      }
      // animation.addEventListener()

    </script>
  </head>
  <body onload="init();">
    <canvas id="gamecanvas" width="700" height="600"></canvas>
  </body>
</html>
